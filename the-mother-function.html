<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Mother Function - spirits away</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
    <link rel="stylesheet" href="./theme/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="./theme/font-icons/style.min.css" type="text/css" />
    <link rel="stylesheet" href="./theme/css/niu2.min.css" type="text/css" />

    <link rel="canonical" href="./the-mother-function.html" />
    
    <script type="text/javascript">window.onload=function(){};</script>
    <!--[if lt IE 9]>
        <script src="./theme/js/html5shiv.js"></script>
        <script src="./theme/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body> 
    <div id="body-header">
<div class="navbar navbar-inverse navbar-fixed-top">
<div class="col-md-12">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href=".">
            <i class="icon-home"></i>spirits away
        </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
        <ul class="nav navbar-nav">
            <li><a href="/pages/about.html" title="about">
                <i class="icon-anchor"></i>关于</a>
            </li>
            <li><a href="/archives.html" title="archives">
                <i class="icon-archive"></i>存档</a>
            </li>
            <li><a href="/tags.html" title="tags">
                <i class="icon-tag"></i>标签</a>
            </li>
        <!-- category dropdown list -->
        <!--  self defined dropdown list -->
        </ul>
        
        <!-- right nav bar -->
        <ul class="nav navbar-nav navbar-right">
        <!-- google custom search -->
       </ul>
    </nav>
</div>
</div>    </div>
    
    <div id="body-content">
<div class="col-md-8 col-md-offset-2">
    <h1 id="content-heading">The Mother Function</h1>
</div>
<div id="niu2-left-container" class="col-md-6 col-md-offset-2 with-right-border">
    <div id="niu2-main-content">
        <p>生成函数(mother function)是一种非常诡异的求数列通项的方法。核心思想是把数列<span class="math">\(a\)</span>的第<span class="math">\(n\)</span>项当作某个某个位置函数<span class="math">\(A(x)\)</span>的<span class="math">\(x^n\)</span>系数系数。我们通过递推式来求得<span class="math">\(A(x)\)</span>，然后将<span class="math">\(A(x)\)</span>展开来得到<span class="math">\(x^n\)</span>的系数既是数列的通项：</p>
<div class="math">\begin{equation}A(x)=\sum_{i=0}{a_i*x^i}\end{equation}</div>
<p>
下面我们就以几个循序渐进的例子来讲解这个生成函数方法的使用。</p>
<h1 id="96ee5a">线性递推</h1>
<p>线性递推式是数列递推式中最简单的递推式，其形式如下：</p>
<div class="math">\begin{equation}a_{n+1}=p*a_n+q\end{equation}</div>
<p>
其中<span class="math">\(p,q\)</span>为常数。这里为了简单起见，我们以<span class="math">\(p=2,q=1,a_0=0\)</span>为例来说明生成函数方法的使用。假设该数列的生成函数为<span class="math">\(A(x)=\sum_{i=0}{a_ix^i}\)</span>,则我们可以得到</p>
<div class="math">\begin{equation}\begin{aligned}A(x)&amp;=\sum_{i=0}{a_ix^i}\\&amp;=a_0 +\sum_{i=0}{a_{i+1}x^{i+1}}\\&amp;=a_0+\sum_{i=0}{(2*a_i+1)x^{i+1}}\\&amp;=a_0+x*(2*\sum_{i=0}{a_ix^i}+\sum_{i=0}{x^i})\\&amp;=a_0+x*(2*A(x)+\sum_{i=0}{x^i})\\&amp;=a_0+2x*A(x)+\frac{x}{1-x}\\&amp;=2x*A(x)+\frac{x}{1-x}\end{aligned}\end{equation}</div>
<p>
由此我们可以得到：</p>
<div class="math">\begin{equation}\begin{aligned}A(x)&amp;=\frac{x}{(1-x)(1-2x)}\\&amp;=x\left\{\frac{2}{1-2x}-\frac{1}{1-x}\right\}\\&amp;=\{2x+(2x)^2+(2x)^3+\cdots\}-\{x+x^2+x^3+\cdots\}\\&amp;=\sum_{i=1}{(2^i-1)x^i}\end{aligned}\end{equation}</div>
<p>
所以，通过这么长的递推,我们终于得到了<span class="math">\(a_i=2^i-1\)</span>，虽然说这个递推高一水平的人就可以做出来。但是我们总是会经历一个从这TM也需要证到这TM也能证的过程吧。</p>
<h1 id="8e30e4">伪线性递推</h1>
<p>所谓伪线性递推是我生造的一个词，其递推结构与之前的一样，只不过<span class="math">\(q,p\)</span>可能为<span class="math">\(i\)</span>的线性表示。下面以例子来说明：</p>
<div class="math">\begin{equation}a_{i+1}=2a_i+i \quad a_0=1\end{equation}</div>
<p>
这里重复之前的推导过程，我们可以得到:</p>
<div class="math">\begin{equation}\frac{A(x)-1}=2x*A(x)+x\sum_{i=1}{ix^i}\end{equation}</div>
<p>
此时我们需要利用微积分的知识：</p>
<div class="math">\begin{equation}\sum_{i=1}{ix^i}=\sum_{i=1}{x(\frac{d(x^n)}{dx})}=x(\frac{d}{dx})\sum_{i=1}{x^i}=x(\frac{d}{dx})\frac{1}{1-x})=\frac{x}{(1-x)^2}\end{equation}</div>
<p>
所以，我们将上式带入到之前，可以得到：</p>
<div class="math">\begin{equation}A(x)=\frac{1-2x+2x^2}{(1-x)^2(1-2x)}=\frac{-1}{(1-x)^2}+\frac{2}{1-2x}\end{equation}</div>
<p>
又因为</p>
<div class="math">\begin{equation}\frac{1}{(1-x)^2}=\sum_{i=0}{(i+1)x^i}\end{equation}</div>
<p>
所以</p>
<div class="math">\begin{equation}a_i=2^{i+1}-i-1\end{equation}</div>
<h1 id="821a2b">斐波那契数列</h1>
<p>斐波那契数列作为数列里面最经典的例子，本文自然不能放过。其数列递推式如下:</p>
<div class="math">\begin{equation}F_{n+2}=F_{n+1}+F_n \quad  w.r.t. \quad F_0=0,F_1=1\end{equation}</div>
<p>
同样 ，设其生成函数为<span class="math">\(A(x)\)</span> ，我们可以得到</p>
<div class="math">\begin{equation}\begin{aligned}A(x)&amp;=x+x(F_2x+F_3x^2+F_4x^3+\cdots)\\&amp;=x+x\left\{\{F_1x+F_2x^2+F_3x^3+\cdots\}+\{F_0x+F_1x^2+F_2x^3+\cdots\}\right\}\\&amp;=x+x(A(x)+xA(x))\end{aligned}\end{equation}</div>
<p>
所以</p>
<div class="math">\begin{equation}A(x)=\frac{x}{1-x-x^2}=\frac{1}{\sqrt{5}}\left\{\frac{1}{(1-(1+\sqrt{5})x/2}-\frac{1}{1-(1-\sqrt{5})x/2}\right\}\end{equation}</div>
<p>
然后经过一些稀里糊涂的中间步骤，我们可以得到</p>
<div class="math">\begin{equation}F_i=\frac{1}{\sqrt{5}}\big((\frac{1+\sqrt{5}}{2})^i-(\frac{1+\sqrt{5}}{2})^i\big)\end{equation}</div>
<h1 id="c15501">双索引递推</h1>
<p>在上文中我们只涉及到了一个变量<span class="math">\(x\)</span>，此时对应只有一个索引的数列的情况。对于有两个不同索引的数列递推式，单一变量的生成函数不再适用，我们需要添加另外的一个变量<span class="math">\(y\)</span>来构造双变量的生成函数<span class="math">\(B(x,y)\)</span>。这种情况。在排列组合问题中，双索引的数列是非常常见的。例如，给定非负整数<span class="math">\(n,k\)</span>且<span class="math">\(0\le k\le n\)</span>，我们能从<span class="math">\(\{1,2,\cdots , n\}\)</span>中得到多少个不同的<span class="math">\(k\)</span>子集。</p>
<p>此时我们假设<span class="math">\(f(n,k)\)</span>是该问题的解，我们可以非常容易的得到下面的递推式</p>
<div class="math">\begin{equation}\label{二项式}f(n,k)=f(n-1,k)+f(n-1,k-1) \quad w.r.t. f(n,0)=1\end{equation}</div>
<p>
此时我们定义一个新的生成函数</p>
<div class="math">\begin{equation}B_n(x)=\sum_{k\ge0}{f(n,k)x^k}\end{equation}</div>
<p>
根据原来的递推公式\ref{二项式}，我们可以得到</p>
<div class="math">\begin{equation}\begin{aligned}&amp; B_n(x)-1=(B_{n-1}(x)-1)+xB_{n-1}(x)\\\Rightarrow &amp; B_n(x)=(1+x)B_{n-1}(x)\\\Rightarrow &amp; B_n(x)=(1+x)^n\\\Rightarrow &amp; f(n,k)=\binom{n}{k}\end{aligned}\end{equation}</div>
<h1 id="32c5e0">双变量生成函数</h1>
<p>对付一些简单的双索引递推公式，我们很多时候用单变量的生成函数即可处理。然而，不是所有的双索引递推都是这么简单的。考虑下面的一个排列组合的例子：将一个大小为<span class="math">\(n\)</span>的集合分割为<span class="math">\(k\)</span>个不为空的子集。例如<span class="math">\(n=4,k=2\)</span>时，其不同划分有如下几种：</p>
<div class="math">\begin{equation}    (12),(34);(13),(24);(14),(23);(123),(4);(124),(3);(134),(2);(234)(1)    \end{equation}</div>
<p>
我们用<span class="math">\(f(n,k)\)</span>来代表其不同的子集划分数。根据<span class="math">\(\{n\}\)</span>这个元素是否单独作为一个集合，我们可以把原来的问题分为两种情况：</p>
<ul>
<li>
<p>是单独集合，原问题规约到了将<span class="math">\(n-1\)</span>个元素划分为<span class="math">\(k-1\)</span>子集的问题，此时的子集划分个数为<span class="math">\(f(n-1,k-1)\)</span>;</p>
</li>
<li>
<p>不是单独集合，此时对于任意的一个<span class="math">\(n-1\)</span>元素的<span class="math">\(k\)</span>划分，元素<span class="math">\(n\)</span>可以插入到这<span class="math">\(k\)</span>个划分的任意一个集合中，此时的子集划分个数为<span class="math">\(f(n-1,k)*k\)</span>。</p>
</li>
</ul>
<p>所以，我们有如下的递推式：</p>
<div class="math">\begin{equation}    f(n,k)=f(n-1,k-1)+kf(n-1,k) \quad w.r.t.\quad n\ge k\ge 0\end{equation}</div>
<p>
此时，我们设</p>
<div class="math">\begin{equation}    B_k(x)=\sum_{n}{f(n,k)x^n}\end{equation}</div>
<p>
由此定义我们可以得到：</p>
<div class="math">\begin{equation}\begin{aligned}B_k(x)&amp;=\sum_{n}{f(n,k)x^n}\\&amp;=\sum_{n}{(f(n-1,k-1)x^n+kf(n-1,k)x^n}\\&amp;=x\sum_{n}{f(n-1,k-1)x^{n-1}}+kx\sum_{n}{f(n-1,k)x^{n-1}}\\&amp;=xB_{k-1}(x)+kxB_k(x)\end{aligned}\end{equation}</div>
<p>
所以，我们可以得到<span class="math">\(B_k(x)\)</span>的解析式为</p>
<div class="math">\begin{equation}B_k(x)=\frac{x}{1-kx}B_{k-1}(x)=\frac{x^k}{(1-x)(1-2x)(1-3x)\cdots(1-kx)}\end{equation}</div>
<p>
现在我们的问题就在于如何求出后面的展开式。为此，我们定义一个记号<span class="math">\([x^n]B(x)\)</span>为函数<span class="math">\(B(x)\)</span>展开式中<span class="math">\(x^n\)</span>的系数。此时</p>
<div class="math">\begin{equation}\begin{aligned}f(n,k)&amp;=[x^n]\left\{\frac{x^k}{(1-x)(1-2x)(1-3x)\cdots(1-kx)}\right\}\\&amp;=[x^{n-k}]\left\{\frac{1}{(1-x)(1-2x)(1-3x)\cdots(1-kx)}\right\}\\&amp;=[x^{n-k}]\sum_{r=1}^{k}{\frac{{\alpha}_r}{1-rx}} \\&amp;=\sum_{r=1}^{k}{{\alpha}_r[x^{n-k}]\frac{1}{1-rx}}\\&amp;=\sum_{r=1}^{k}{{\alpha}_r r^{n-k}}\end{aligned}\end{equation}</div>
<p>
在这里我们得到了一个看上去非常美的结果，但是其实目前还没啥用，因为我们还没有求出满足下式的常数<span class="math">\({\alpha}_r\)</span>。</p>
<div class="math">\begin{equation}\frac{x^k}{(1-x)(1-2x)(1-3x)\cdots(1-kx)}=\sum_{i=1}^{k}{\frac{{\alpha}_i}{1-ix}}\end{equation}</div>
<p>
为了得到<span class="math">\({\alpha}_r\)</span>,我们又需要利用一些诡异的技巧。首先在上式两边都乘以<span class="math">\(1-rx\)</span>，然后令<span class="math">\(x=1/r\)</span>。此时右边就只剩下<span class="math">\({\alpha}_r\)</span>了。所以</p>
<div class="math">\begin{equation}\begin{aligned}{\alpha}_r&amp;=\frac{1}{(1-1/r)(1-2/r)\cdots (1-(r-1)/r)(1-(r+1)/r)\cdots (1-k/r)}\\&amp;={(-1)}^{k-r}\frac{r^{k-1}}{(r-1)!(k-r)!}\end{aligned}\end{equation}</div>
<p>
将此式带入之前的式子，可得</p>
<div class="math">\begin{equation}f(n,k)=\sum_{r=1}^{k}{(-1)^{k-r}}{\frac{r^n}{r!(k-r)!}}\end{equation}</div>
<p>
现在是不是感觉很爽! </p>
<p>其实写本篇文章的动机是为了求解这个递推式</p>
<div class="math">\begin{equation}f(m,n)=m*(f(m-1,n-1)+f(m,n-1))\quad n \geq m \quad  f(m,m)=m! \, f(1,n)=1\end{equation}</div>
<p>
该递推式的背景是一道微软的面试题，具体的内容忘记了。这是一个写代码的题，主要考察点是DP优化。但是正如前面所说的，我们可以直接求出其通项公式。其求解过程跟之前的基本一样.此时，我们设</p>
<div class="math">\begin{equation}    B_k(x)=\sum_{n}{f(n,k)x^n}\end{equation}</div>
<p>
由此定义我们可以得到：</p>
<div class="math">\begin{equation}\begin{aligned}B_k(x)&amp;=\sum_{n}{f(n,k)x^n}\\&amp;=k\sum_{n}{(f(n-1,k-1)x^n+f(n-1,k)x^n}\\&amp;=kx\sum_{n}{f(n-1,k-1)x^{n-1}}+kx\sum_{n}{f(n-1,k)x^{n-1}}\\&amp;=kx(B_{k-1}(x)+B_k(x))\end{aligned}\end{equation}</div>
<p>
所以，我们可以得到<span class="math">\(B_k(x)\)</span>的解析式为</p>
<div class="math">\begin{equation}B_k(x)=\frac{kx}{1-kx}B_{k-1}(x)=\frac{x^kk!}{(1-x)(1-2x)(1-3x)\cdots(1-kx)}\end{equation}</div>
<p>
由此可得</p>
<div class="math">\begin{equation}\begin{aligned}f(n,k)&amp;=k![x^n]\left\{\frac{x^k}{(1-x)(1-2x)(1-3x)\cdots(1-kx)}\right\}\\&amp;=k![x^{n-k}]\left\{\frac{1}{(1-x)(1-2x)(1-3x)\cdots(1-kx)}\right\}\\&amp;=k![x^{n-k}]\sum_{r=1}^{k}{\frac{{\alpha}_r}{1-rx}} \\&amp;=k!\sum_{r=1}^{k}{{\alpha}_r[x^{n-k}]\frac{1}{1-rx}}\\&amp;=k!\sum_{r=1}^{k}{{\alpha}_r r^{n-k}}\\&amp;=k!\sum_{r=1}^{k}{(-1)^{k-r}}{\frac{r^n}{r!(k-r)!}}\end{aligned}\end{equation}</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
    </div>
    <div id="content-comments">
</div>

</div>
<div class="niu2-right-container col-md-2">
    <div id="niu2-sidebar-meta" class="niu2-sidebar">
        <div class="niu2-sidebar-label"><i class="icon-calendar"></i>Published:</div>
        <div class="niu2-sidebar-value">2015-04-28 19:37</div>
        <div class="niu2-sidebar-label"><i class="icon-open-folder"></i>Category:</div>
        <div class="niu2-sidebar-value"><a href="./category/math.html">Math</a></div>
        <div class="niu2-sidebar-label"><i class="icon-tag"></i>Tag:</div>
 
            <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="./tag/mother-function.html">Mother Function</a><sup>1</sup></div>
            <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="./tag/math.html">Math</a><sup>6</sup></div>
            <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="./tag/algorithm.html">Algorithm</a><sup>5</sup></div>
    </div>

    <div id="niu2-sidebar-toc" class="niu2-sidebar" data-status="closed">
        <div class="niu2-sidebar-label">
            <i id="niu2-sidebar-toc-ctrl" class="icon-open-tocs"></i>TOC
        </div>
        <ol id="niu2-sidebar-toc-list">
            <li><a href="#content-heading">The Mother Function</a></li>
            <li><a href='#96ee5a'>线性递推</a></li><li><a href='#8e30e4'>伪线性递推</a></li><li><a href='#821a2b'>斐波那契数列</a></li><li><a href='#c15501'>双索引递推</a></li><li><a href='#32c5e0'>双变量生成函数</a></li>
        </ol>
    </div>
</div>    </div>

    <div class="niu2-footer">
        <div id="body-footer" class="col-md-6 col-md-offset-2">
<hr/>
<p>
    Powered by <a href="https://github.com/getpelican/pelican">Pelican</a>, 
    <a href="https://github.com/mawenbao/niu-x2-sidebar">theme</a> built with <a href="http://getbootstrap.com">Bootstrap3</a>
    by <a href="http://blog.atime.me">Ma Wenbao</a>, icons by 
    <a href="http://fortawesome.github.io/Font-Awesome">Font Awesome</a>.
</p>
<p>
    ©
            2014-2017
    <a class="niu2-footer-link" href=".">Huiliang Huang</a>
</p>
<p class="niu2-icons">
</p>        </div>
    </div>
    
    <div id="niu2-pygments" data-theme="github"></div>

    <script type="text/javascript" src="./theme/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="./theme/js/niu2.min.js"></script>
    <script type="text/javascript" src="./theme/js/bootstrap.min.js"></script>
    <script type="text/javascript">onContentLoaded();</script>
  </body>
</html>